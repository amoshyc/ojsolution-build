

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>[cfedu6] E. New Year Tree &mdash; amoshyc&#39;s 題解</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/mine.css" type="text/css" />
  

  
    <link rel="top" title="amoshyc&#39;s 題解" href="../../index.html"/>
        <link rel="up" title="Educational Round #6" href="index.html"/>
        <link rel="next" title="3. POJ" href="../../poj/poj.html"/>
        <link rel="prev" title="[cfedu6] D. Professor GukiZ and Two Arrays" href="pd.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> amoshyc's 題解
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">1. 常用演算法教學</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../cf.html">2. CF</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../cf.html#regular-round">Regular Round</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../cf.html#educational-round">Educational Round</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cfedu16/index.html">#16</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cfedu12/index.html">#12</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cfedu9/index.html">#9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cfedu8/index.html">#8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cfedu7/index.html">#7</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">#6</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pa.html">[cfedu6] A. Professor GukiZ&#8217;s Robot</a></li>
<li class="toctree-l4"><a class="reference internal" href="pb.html">[cfedu6] B. Grandfather Dovlet’s calculator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pc.html">[cfedu6] C. Pearls in a Row</a></li>
<li class="toctree-l4"><a class="reference internal" href="pd.html">[cfedu6] D. Professor GukiZ and Two Arrays</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">[cfedu6] E. New Year Tree</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../poj/poj.html">3. POJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uva/uva.html">4. UVA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ptc/ptc.html">5. PTC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/other.html">6. Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../template/template.html">7. Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tags.html">8. Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet.html">9. Cheatsheet</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">amoshyc's 題解</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../cf.html">2. CF</a> &raquo;</li>
      
          <li><a href="index.html">Educational Round #6</a> &raquo;</li>
      
    <li>[cfedu6] E. New Year Tree</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cfedu6-e-new-year-tree">
<h1><a class="toc-backref" href="#id4">[cfedu6] E. New Year Tree</a><a class="headerlink" href="#cfedu6-e-new-year-tree" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Tags</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">tag_dfs</span></code></li>
<li><code class="docutils literal"><span class="pre">tag_segment_tree</span></code></li>
<li><code class="docutils literal"><span class="pre">tag_bitmask</span></code></li>
</ul>
</div>
<div class="contents topic" id="toc">
<p class="topic-title first">TOC</p>
<ul class="simple">
<li><a class="reference internal" href="#cfedu6-e-new-year-tree" id="id4">[cfedu6] E. New Year Tree</a><ul>
<li><a class="reference internal" href="#id2" id="id5">題目</a></li>
<li><a class="reference internal" href="#specification" id="id6">Specification</a></li>
<li><a class="reference internal" href="#id3" id="id7">分析</a></li>
<li><a class="reference internal" href="#ac-code" id="id8">AC Code</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="reference external" href="http://codeforces.com/contest/620/problem/E">題目</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>給定一個大小為 N 的樹 T，根的邊號為 1，每個節點上有其顏色。
請寫一個程式支援 M 個操作。操作的種類為</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">v</span> <span class="pre">c</span></code> 將以 v 為根的子樹的每個節點的顏色都改為顏色 c</li>
<li><code class="docutils literal"><span class="pre">2</span> <span class="pre">v</span></code> 輸出以 v 為根的子樹中共有幾種不同的顏色</li>
</ol>
</div></blockquote>
<p>顏色最多只有 60 種。</p>
</div>
<div class="section" id="specification">
<h2><a class="toc-backref" href="#id6">Specification</a><a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">500000</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id7">分析</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">dfs 轉線段樹</p>
</div>
<p>首先我們利用 dfs 將 T 轉為線段樹，即將每個節點用 dfs 迭代的順序重新編號。
這樣做有一個好處:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>對某個子樹進行的操作 變成 對某個區間進行操作。
</pre></div>
</div>
<img alt="http://i.imgur.com/0biWz91.png" src="http://i.imgur.com/0biWz91.png" />
<p>具體來說，dfs 的同時，記錄每個節點 v，以 v 為根的子樹對應到哪個區間，
將之儲存在 idxL[v], idxR[v] 這兩個陣列裡。這是一個半開區間。</p>
<p>這題的操作就變成</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">v</span> <span class="pre">c</span></code> 將區間 [idxL[v], idxR[v]) 都改為 c</li>
<li><code class="docutils literal"><span class="pre">2</span> <span class="pre">v</span></code> 輸出區間 [idxL[v], idxR[v]) 中共有幾個不同的數字</li>
</ol>
</div></blockquote>
<p>這樣這題就變成線段樹的區間查詢。
可以利用 bitwise-OR 並把顏色壓進位元裡來實作。</p>
<p>另外，因為有區間更改，所以線段樹需要延遲標記。</p>
</div>
<div class="section" id="ac-code">
<h2><a class="toc-backref" href="#id8">AC Code</a><a class="headerlink" href="#ac-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_N</span> <span class="o">=</span> <span class="mi">400000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_NN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">19</span><span class="p">);</span> <span class="c1">// should be bigger than MAX_N</span>

<span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">A</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<span class="c1">// [L, R)</span>
<span class="kt">int</span> <span class="n">idxL</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idxR</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">dfn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">idxL</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfn</span><span class="o">++</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">idxR</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfn</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">NN</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">seg</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MAX_NN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">lazy</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">MAX_NN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="c1">// lazy[u] != 0 : the subtree of u (u not included) is not up-to-date</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">lc</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rc</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">seg_gather</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">seg</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">|</span> <span class="n">seg</span><span class="p">[</span><span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">)];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">seg_push</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>

        <span class="n">lazy</span><span class="p">[</span><span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
        <span class="n">lazy</span><span class="p">[</span><span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
        <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">seg_init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">NN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">NN</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">NN</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">fill</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">seg</span> <span class="o">+</span> <span class="n">NN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">fill</span><span class="p">(</span><span class="n">lazy</span><span class="p">,</span> <span class="n">lazy</span> <span class="o">+</span> <span class="n">NN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">NN</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">idxL</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ll</span> <span class="o">&lt;&lt;</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">seg_build</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="n">NN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// leaf</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">seg_build</span><span class="p">(</span><span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
    <span class="n">seg_build</span><span class="p">(</span><span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
    <span class="n">seg_gather</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">seg_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">b</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ll</span> <span class="o">&lt;&lt;</span> <span class="n">delta</span><span class="p">);</span>
        <span class="n">lazy</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ll</span> <span class="o">&lt;&lt;</span> <span class="n">delta</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">seg_push</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">seg_update</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="n">seg_update</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">seg_gather</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="nf">seg_query</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">b</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">seg</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">seg_push</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">|=</span> <span class="n">seg_query</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lc</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="n">ans</span> <span class="o">|=</span> <span class="n">seg_query</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rc</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">seg_gather</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">N</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">M</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span> <span class="n">u</span><span class="o">--</span><span class="p">;</span> <span class="n">v</span><span class="o">--</span><span class="p">;</span>
        <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
        <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">seg_init</span><span class="p">();</span>
    <span class="n">seg_build</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">M</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cmd</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span> <span class="n">v</span><span class="o">--</span><span class="p">;</span>
            <span class="n">seg_update</span><span class="p">(</span><span class="n">idxL</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">idxR</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NN</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span><span class="p">;</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span> <span class="n">v</span><span class="o">--</span><span class="p">;</span>
            <span class="n">ll</span> <span class="n">res</span> <span class="o">=</span> <span class="n">seg_query</span><span class="p">(</span><span class="n">idxL</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">idxR</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NN</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__builtin_popcountll</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../poj/poj.html" class="btn btn-neutral float-right" title="3. POJ" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pd.html" class="btn btn-neutral" title="[cfedu6] D. Professor GukiZ and Two Arrays" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, amoshyc.
      Last updated on Sep 20, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>