

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Treap (implicit key) &mdash; amoshyc&#39;s 題解</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/mine.css" type="text/css" />
  

  
    <link rel="top" title="amoshyc&#39;s 題解" href="../../index.html"/>
        <link rel="up" title="Data Structure" href="index.html"/>
        <link rel="next" title="Graph" href="../graph/index.html"/>
        <link rel="prev" title="Treap (bst)" href="treap_bst.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> amoshyc's 題解
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">1. 常用演算法教學</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cf/cf.html">2. CF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../poj/poj.html">3. POJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uva/uva.html">4. UVA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ptc/ptc.html">5. PTC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/other.html">6. Other</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../template.html">7. Template</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Data Structure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="dsu.html">Disjoint Set 並查集</a></li>
<li class="toctree-l3"><a class="reference internal" href="seg.html">Segment Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse_table.html">Sparse Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="bit.html">BIT</a></li>
<li class="toctree-l3"><a class="reference internal" href="bit2d.html">BIT 2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="trie.html">Trie (Fixed Length)</a></li>
<li class="toctree-l3"><a class="reference internal" href="treap_bst.html">Treap (bst)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Treap (implicit key)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">程式碼</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">模板驗證</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../graph/index.html">Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tree/index.html">Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dp/index.html">DP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/index.html">Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../string/index.html">String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../search/index.html">Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/index.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/index.html">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tags.html">8. Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet.html">9. Cheatsheet</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">amoshyc's 題解</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../template.html">7. Template</a> &raquo;</li>
      
          <li><a href="index.html">Data Structure</a> &raquo;</li>
      
    <li>Treap (implicit key)</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="treap-implicit-key">
<h1><a class="toc-backref" href="#id3">Treap (implicit key)</a><a class="headerlink" href="#treap-implicit-key" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Tags</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">tag_treap</span></code></li>
<li><code class="docutils literal"><span class="pre">tag_template</span></code></li>
</ul>
</div>
<div class="contents topic" id="toc">
<p class="topic-title first">TOC</p>
<ul class="simple">
<li><a class="reference internal" href="#treap-implicit-key" id="id3">Treap (implicit key)</a><ul>
<li><a class="reference internal" href="#id1" id="id4">程式碼</a></li>
<li><a class="reference internal" href="#id2" id="id5">模板驗證</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id4">程式碼</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Remember srand(time(NULL)), but it cannot be used on poj(g++)</span>
<span class="k">struct</span> <span class="n">Treap</span> <span class="p">{</span> <span class="c1">// implicit key (key = index)</span>
    <span class="kt">int</span> <span class="n">pri</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">inc</span><span class="p">,</span> <span class="n">mn</span><span class="p">;</span> <span class="kt">bool</span> <span class="n">rev</span><span class="p">;</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">lch</span><span class="p">,</span> <span class="o">*</span><span class="n">rch</span><span class="p">;</span>
    <span class="n">Treap</span><span class="p">()</span> <span class="p">{}</span>
    <span class="n">Treap</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pri</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">rev</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">lch</span> <span class="o">=</span> <span class="n">rch</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">size</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">?</span> <span class="n">t</span><span class="o">-&gt;</span><span class="nl">size</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Notice that lch, rch may be NULL</span>
<span class="c1">// flag t-&gt;inc is set,</span>
<span class="c1">// =&gt; the subtree of t (t not included) is not up-to-date</span>
<span class="c1">// flag t-&gt;rev is set,</span>
<span class="c1">// =&gt; every node in substree of t (t not included) should</span>
<span class="c1">//    swap its 2 children</span>
<span class="c1">// Every Treap corresponds to a range in array</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">push</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rev</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">swap</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">);</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">swap</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">);</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">t</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">inc</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">inc</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
            <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">+=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">t</span><span class="o">-&gt;</span><span class="n">inc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pull</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">);</span>

    <span class="n">t</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">mn</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="o">-&gt;</span><span class="n">mn</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">)</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">mn</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="o">-&gt;</span><span class="n">mn</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">NN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Treap</span> <span class="n">pool</span><span class="p">[</span><span class="mi">200000</span><span class="p">];</span>

<span class="kr">inline</span> <span class="n">Treap</span><span class="o">*</span> <span class="nf">new_treap</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pool</span><span class="p">[</span><span class="n">NN</span><span class="p">]</span> <span class="o">=</span> <span class="n">Treap</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">pool</span><span class="p">[</span><span class="n">NN</span><span class="o">++</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">Treap</span><span class="o">*</span> <span class="nf">merge</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">Treap</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span> <span class="o">||</span> <span class="o">!</span><span class="n">b</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">pri</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">pri</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="n">a</span><span class="o">-&gt;</span><span class="n">rch</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="n">pull</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">push</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="n">b</span><span class="o">-&gt;</span><span class="n">lch</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">);</span>
        <span class="n">pull</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// size(a) will be k</span>
<span class="c1">// t is unable to use afterwards</span>
<span class="kt">void</span> <span class="nf">split</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">push</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">pull</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
        <span class="n">pull</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">inc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> <span class="c1">// t -&gt; a, b</span>
    <span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// a -&gt; c, d</span>
    <span class="n">d</span><span class="o">-&gt;</span><span class="n">inc</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">;</span>
    <span class="n">d</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">;</span>
    <span class="n">d</span><span class="o">-&gt;</span><span class="n">mn</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> <span class="c1">// t -&gt; a, b</span>
    <span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// a -&gt; c, d</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">);</span>
    <span class="n">d</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">revolve</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 右移 k 位</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> <span class="c1">// t -&gt; a, b</span>
    <span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// a -&gt; c, d</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">%</span> <span class="n">len</span><span class="p">;</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="n">k</span><span class="p">);</span> <span class="c1">// d -&gt; e, f</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">merge</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="p">)),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">new_treap</span><span class="p">(</span><span class="n">val</span><span class="p">)),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// t -&gt; a, b</span>
    <span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// b -&gt; c, d</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">get_min</span><span class="p">(</span><span class="n">Treap</span><span class="o">*&amp;</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Treap</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> <span class="c1">// t -&gt; a, b</span>
    <span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// a -&gt; c, d</span>
    <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">mn</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>For debugging</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">pp</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(size = %d, val = %d, pri = %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">pri</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">string</span> <span class="n">ind</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">ind</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;NULL&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
        <span class="n">dfs</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="s">&quot;L   &quot;</span><span class="p">);</span>
        <span class="n">dfs</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="s">&quot;R   &quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inorder</span><span class="p">(</span><span class="n">Treap</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">inorder</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">lch</span><span class="p">);</span>
    <span class="n">pp</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="n">inorder</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">rch</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id5">模板驗證</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="../../poj/p3580.html">poj3580</a></p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../graph/index.html" class="btn btn-neutral float-right" title="Graph" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="treap_bst.html" class="btn btn-neutral" title="Treap (bst)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, amoshyc.
      Last updated on Sep 18, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>